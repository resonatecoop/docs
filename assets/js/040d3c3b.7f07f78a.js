"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[586],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>k});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(a),k=r,m=u["".concat(s,".").concat(k)]||u[k]||d[k]||o;return a?n.createElement(m,i(i({ref:t},c),{},{components:a})):n.createElement(m,i({ref:t},c))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},4469:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={sidebar_position:1,title:"API"},i=void 0,l={unversionedId:"active-development/api",id:"active-development/api",title:"API",description:"Explore the api repository...",source:"@site/docs/active-development/api.md",sourceDirName:"active-development",slug:"/active-development/api",permalink:"/docs/active-development/api",draft:!1,editUrl:"https://github.com/resonatecoop/api/edit/main/README.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"API"},sidebar:"tutorialSidebar",previous:{title:"Active Development",permalink:"/docs/category/active-development"},next:{title:"Beam",permalink:"/docs/active-development/beam"}},s={},p=[{value:"Getting started with local dev",id:"getting-started-with-local-dev",level:2},{value:"Docs",id:"docs",level:2},{value:"Workers (Uploading Music, Images, Etc)",id:"workers-uploading-music-images-etc",level:2},{value:"Docker tips &amp; tricks",id:"docker-tips--tricks",level:2},{value:"Resetting the database",id:"resetting-the-database",level:3},{value:"Conflicting PGSQL",id:"conflicting-pgsql",level:3},{value:"Connecting to the database with an external databse tool",id:"connecting-to-the-database-with-an-external-databse-tool",level:3},{value:"Authentication",id:"authentication",level:2}],c={toc:p};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Explore the ",(0,r.kt)("code",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/resonatecoop/api"},"api"))," repository..."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\ud83d\udee0 ",(0,r.kt)("strong",{parentName:"p"},"Status: Active Development | Experimental")),(0,r.kt)("p",{parentName:"blockquote"},"This project is currently broken and under very active development.")),(0,r.kt)("h1",{id:"tracks-api-v4-lol"},"Tracks API (v4 lol)"),(0,r.kt)("p",null,"A rewrite of the Resonate tracks api, but with one database to rule them all."),(0,r.kt)("p",null,"View the ",(0,r.kt)("a",{parentName:"p",href:"https://mattermost.resonate.coop/plugins/focalboard/workspace/gr3aqjbmw3d7fp3wukfw7hhppr/shared/bzkz3bnxxsbny3doh9aqhqy8cth/vzfpkzytdq3rkfjjwzagshoyrho?r=kwx8xtyxwcpmqsnh67iz8x74p7a"},"product backlog"),", where work is tracked for this repository."),(0,r.kt)("h2",{id:"getting-started-with-local-dev"},"Getting started with local dev"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"git clone <repo>\ncd <repo>\ncp .env.example .env\ncp jwk-keys.json.example jwk-keys.json\ncp cookies-keys.json.example cookies-keys.json\n\ndocker-compose up\n")),(0,r.kt)("p",null,"Migrations should have run as part of ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up")),(0,r.kt)("p",null,"Seed the data"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn docker:seed:all\n")),(0,r.kt)("h2",{id:"docs"},"Docs"),(0,r.kt)("p",null,"Swagger generates docs, you can see them at: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"http://localhost:4000/docs\n")),(0,r.kt)("h2",{id:"workers-uploading-music-images-etc"},"Workers (Uploading Music, Images, Etc)"),(0,r.kt)("p",null,"If you want to upload music or upload images, you'll need a worker running."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker exec -it resonate-api node src/jobs/queue-worker.js run convert-audio\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"TODO: we should look into setting this up so that it starts running automatically on ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up"),". The ",(0,r.kt)("em",{parentName:"p"},"right")," way to do this is probably to set up a container that launches the job.")),(0,r.kt)("h2",{id:"docker-tips--tricks"},"Docker tips & tricks"),(0,r.kt)("p",null,"Hard rebuild the docker container"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"sudo rm -rf data/ && docker-compose up --build\n")),(0,r.kt)("p",null,"Poke around the resonate db"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker ps # look for the resonate pgsql container name\ndocker exec -it <resonate-pgsql-container-name> psql -U resonate\n")),(0,r.kt)("h3",{id:"resetting-the-database"},"Resetting the database"),(0,r.kt)("p",null,"This will need to be run to reset the database periodically while migrations are still being squared away."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn docker:migrate:undo:all\nyarn docker:migrate\nyarn docker:seed:all\n")),(0,r.kt)("h3",{id:"conflicting-pgsql"},"Conflicting PGSQL"),(0,r.kt)("p",null,"If you already have PGSQL running on your system, you will need to use a different PGSQL port for the Dockerized Resonate database."),(0,r.kt)("p",null,"In that case you can set ",(0,r.kt)("inlineCode",{parentName:"p"},"POSTGRES_LOCAL_MACHINE_PORT")," in ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," to a different number, like ",(0,r.kt)("inlineCode",{parentName:"p"},"5433")),(0,r.kt)("p",null,"You can stop (",(0,r.kt)("inlineCode",{parentName:"p"},"docker compose down"),"), change the port in the ",(0,r.kt)("inlineCode",{parentName:"p"},".env"),"file, and then restart (",(0,r.kt)("inlineCode",{parentName:"p"},"docker compose up"),")."),(0,r.kt)("h3",{id:"connecting-to-the-database-with-an-external-databse-tool"},"Connecting to the database with an external databse tool"),(0,r.kt)("p",null,"You can connect to the Dockerized database using an external tool. For this example we will use pgAdmin."),(0,r.kt)("p",null,"First, be sure that you are not using the default PG port (5432). Please see the entry above for how to do this."),(0,r.kt)("p",null,"In pgAdmin:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the left-hand panel, there should be a 'Servers' item you can click on"),(0,r.kt)("li",{parentName:"ul"},"Right-click 'Servers', then 'Create, then 'Server...'"),(0,r.kt)("li",{parentName:"ul"},"The 'Create Server' modal should pop up."),(0,r.kt)("li",{parentName:"ul"},"In the 'General' tab, in the 'Name' field, enter a useful name. ",(0,r.kt)("inlineCode",{parentName:"li"},"Resonate-Docker-localhost")," is an example.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"There might be an error to the effect of 'Either host name, Address or Service must be specified.' We fix that in the next step."))),(0,r.kt)("li",{parentName:"ul"},"Click the 'Connection' tab."),(0,r.kt)("li",{parentName:"ul"},"Enter a 'Host name / address'. 'localhost' often works well."),(0,r.kt)("li",{parentName:"ul"},"In the 'Port' field, enter the port for the Resonate database. We use 5433 in keeping with the example above."),(0,r.kt)("li",{parentName:"ul"},"'Maintanence database': resonate"),(0,r.kt)("li",{parentName:"ul"},"Username: (use the username from the ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file)"),(0,r.kt)("li",{parentName:"ul"},"Password: (use the password from the ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file)"),(0,r.kt)("li",{parentName:"ul"},"Select 'Save password' if you are ok with saving the database password"),(0,r.kt)("li",{parentName:"ul"},"Click 'Save'.")),(0,r.kt)("p",null,"There are other tools you can use to look into the Dockerized database instance. One example is the ",(0,r.kt)("inlineCode",{parentName:"p"},"PostgresSQL"),"plug in for VSCode. The steps for connecting might be different, but the required information should be like what appears in this section."),(0,r.kt)("h2",{id:"authentication"},"Authentication"),(0,r.kt)("p",null,"We use OpenID and the oidc-provider library to provide identity. Check out the documentation in ",(0,r.kt)("inlineCode",{parentName:"p"},"src/auth/README.md")))}d.isMDXComponent=!0}}]);